\chapter{実験}
ここでは，提案手法と既存手法との比較実験を行い，提案手法の長所を示す．


\section{データセット}
本実験では，データセットとしてDirectory of Useful Decoys (DUD-E)\cite{Mysinger2012}を用いた．
DUD-Eはカリフォルニア大学サンフランシスコ校のMysingerらによって作成されたドッキングシミュレーション手法を評価するためのデータセットである．
DUD-Eには102種類の標的タンパク質（ターゲット）が登録されており，それぞれに対してタンパク質構造・正例化合物・負例化合物を用意している．
表\ref{table:dude}にターゲットごとの化合物数，正例と負例の比率の最小値，最大値，平均値を示す．
各ターゲットの詳細については付録\ref{appendix:dude}に記載する．なお，DUD-Eのターゲットのうちfgfr1およびfa10は
記載されている負例数とデータセットに実際に含まれている負例数が大きく異なっているが，そのまま扱うこととする．

\begin{table}[htb] \centering
	\caption{DUD-Eのターゲットの化合物数}
	\label {table:dude}
	\begin{tabular}{c|cc}
	\hline
			&総化合物数		&正/負例の比率	\\ \hline
	最大値	&52,022 (fnta)		&1:104 (fnta)		\\
	平均値	&13,881			&1:60			\\
	最小値	&472 (fgfr1)		&1:2.4 (fgfr1)		\\ \hline
	\end{tabular}
\end{table}

	
\section{予測精度の評価指標}
バーチャルスクリーニングでは，計算機による選別を通過して実際に活性実験が行われる化合物数が
もとの化合物と比べてきわめて少ない状況を想定することが多い．
また，化合物データベースの中で実際に標的タンパク質を阻害する化合物は1,000個に1個であると言われており，
したがって正例と負例の比率が大きく偏っていると言える．
そのためこの分野における予測精度の評価指標は以下の2種類が多く用いられている．

\begin{itemize}
\item \b{ROC-AUC}\\
	Receiver Operating Characteristic（ROC）曲線は，正例/負例の予測の閾値を変化させながら，縦軸にTrue Positive（TP）率，横軸にFalse Positive（FP）率をとった曲線である．
	TP率とはデータセット中の正例の中で正しく正例と判別されたものの割合であり，FP率とはデータセット中の負例の中で誤って正例と判別されたものの割合である．
	TP率，FP率はそれぞれ以下の式で求められる．
	\begin{eqnarray}
	{\rm TP率}	&=&	\frac{\rm \#TP}{\rm \#TP+\#FN} \\
	{\rm FP率}	&=&	\frac{\rm \#FP}{\rm \#FP+\#TN}
	\end{eqnarray}
	この方法によって描かれたROC曲線の曲線下面積（Area Under the Curve, AUC）を用いた評価指標がROC-AUCである．
	具体例を図\ref{fig:roc_example}に示す．
\item \b{Enrichment Factor}\\
	Enrichment Factor（EF）とは，予測結果の上位のみを取り出したときに，元々のデータセットからどれだけ正例が「濃縮されたか」を表す指標である．具体例を図\ref{fig:ef_example}に示す．
	上位どのくらいを取り出すかによって値が異なり，上位x\%取り出したときの集合の正例率を正例率（x\%），EFをEF (x\%)と表記することにすると，これらは以下の式で求められる．
	\begin{eqnarray}
	{\rm 正例率（x\%）}	&=& \frac{\rm 正例数（x\%）}{\rm 正例数（x\%）+負例数（x\%）} \\
	{\rm EF（x\%）} 	&=& \frac{\rm 正例率（x\%）}{\rm 正例率（100\%）}
	\end{eqnarray}
\end{itemize}

\begin{figure}[p]
 \begin{center}
  \fig[width=0.99\hsize]{./fig/result/roc計算例.eps}
  \caption{ROC-AUC計算例}
  \label{fig:roc_example}
 \end{center}
\end{figure}
\begin{figure}[htp]
 \begin{center}
  \fig[width=0.99\hsize]{./fig/result/ef計算例.eps}
  \caption{EF計算例}
  \label{fig:ef_example}
 \end{center}
\end{figure}

本研究においては，ROC-AUC，EF（1\%），EF（2\%），EF（5\%），EF（10\%）の5つの指標を用いて手法の評価を行う．


\section{計算環境}
本研究では，東京工業大学のスーパーコンピュータであるTSUBAME 2.5のThinノードを利用した．
利用した計算環境を表\ref{table:computer_node}に示す．

\begin{table}[htb] \centering
	\caption{利用した計算環境}
	\label{table:computer_node}
	\begin{tabular}{cc}
	\hline
	CPU		&Intel Xeon X5670, 2.93 GHz (6 cores) $\times2$ \\
	Memory	& 54 GB RAM \\ \hline 
	\end{tabular}
	\vspace{-2cm}
\end{table}

\section{比較対象}
本提案手法はドッキングに基づくフィルタリング手法であるため，同様の用途に用いられることのあるGlide HTVS（高速）モードを比較対象として用いる．
また，フィルタリングとしての性能を評価するために，Glide SP（通常）モードによる化合物ドッキングシミュレーションと組み合わせた評価も行うため，
計算時間などの評価に関してはGlide SPモードも比較対象とする．

\section{評価実験}

\subsection{フラグメント分割}\label{subsec:result_decomposition}
まず，今回用いる複数のターゲットについて，フラグメント分割を行うことでドッキングの必要数をどの程度減らせるのかを示す．
それぞれターゲットにフラグメント分割を適用した場合における化合物数とフラグメント種類数の推移は図\ref{fig:dude_decomposition}の通り
となり，DUD-Eターゲット全体で平均するとフラグメント種類数は化合物数の約4分の1に抑えられている（表\ref{table:dude_decomposition}）．
化合物数が多いほど化合物数に対するフラグメント種類数が抑えられる傾向にあることも確認された．

\begin{figure}[bhtp]
 \begin{center}
  \fig[width=0.75\hsize]{./fig/result/ターゲットに対するフラグメント数.eps}
	\vspace{-0.5cm}
  \caption{DUD-Eターゲットにおける化合物数とフラグメント種類数の関係}
  \label{fig:dude_decomposition}
 \end{center}
\end{figure}
\begin{table}[htb] \centering
	\caption{DUD-E各ターゲットの化合物群を分割した時のフラグメント１種類あたりの化合物数}
	\label{table:dude_decomposition}
	\begin{tabular}{c|rr}
	\hline
								&\multirow{2}{*}{ターゲット数}	&フラグメント1種類			\\
								&						&あたりの平均化合物数		\\ 
	\hline
	化合物数1万未満のDUD-Eターゲット		&53			&3.17							\\
	化合物数１万以上のDUD-Eターゲット		&49			&4.91							\\ 
	\hline
	全DUD-Eターゲット						&102		&4.00							\\ 
	\hline
	\end{tabular}
\end{table}


\subsection{ドッキング速度の評価}\label{subsec:single_calc_time}
つづいてフィルタリング手法の計算速度を評価する．ここでは以下に示す4種類の手法の計算時間を比較する．
\begin{enumerate}
\item Glide SPモードを利用した通常のドッキングシミュレーション 「Glide SP」
\item Glide HTVSモードを利用した簡易なドッキングシミュレーション 「Glide HTVS」
\item フラグメントのドッキングシミュレーションにGlide SPモードを用いた提案手法 「提案手法（SP）」
\item フラグメントのドッキングシミュレーションにGlide HTVSモードを用いた提案手法 「提案手法（HTVS）」
\end{enumerate}

\ref{subsec:result_decomposition}節で述べたように，1つのターゲットに含まれる化合物数
が多ければ多いほどフラグメント数は相対的に少なくなり提案手法の計算コストの削減が増幅される．
そこでDUD-E 102ターゲット全てでの所要計算時間の平均以外に，総化合物数が最小であるターゲット fgfr1，
総化合物数が平均値に近いターゲット adrb2，総化合物数が最大であるターゲット fntaの3種類について独立して結果を示す．

結果は表\ref{table:calc_time}の通りであり，Glide HTVSモードと比較すると提案手法（SP）は平均約9倍，
提案手法（HTVS）は平均約15倍の速度向上を達成している．

\begin{table}[htb] \centering
	\caption{ドッキング計算時間の比較（括弧内はGlide HTVSとの速度比）}
	\label{table:calc_time}
	\begin{tabular}{c|rr|rrrr}
	\hline
	\multirow{3}{*}{ターゲット名}	&\multirow{3}{*}{総化合物数}	&\multirow{3}{*}{\shortstack{フラグメント\\種類数}}	&\multicolumn{4}{c}{計算時間 [CPU sec.]}										\\
							&							&											&\mrow{2}{Glide SP}	&\mrow{2}{Glide HTVS}	&提案手法		&提案手法		\\
							&							&											&					&					&（SP） 			&（HTVS）		\\ \hline
	fgfr1						&472						&166										&3,523				&566 (x1.0)			&164 (x3.5)		&140 (x4.0)		\\
	adrb2					&15,224						&2,779										&338,511				&17,043 (x1.0)			&1,481 (x11.5)		&899 (x19.0)		\\
	fnta						&52,022						&7,767										&1,770,967			&98,665 (x1.0)			&4,149 (x24.0)		&2,549 (x38.7)		\\ \hline
	全ての平均				&13,881						&3,231										&236,156				&14,813 (x1.0)			&1,673 (x8.9)		&987 (x15.0)		\\ \hline
	\end{tabular}
\end{table}

\subsection{予測精度の評価}\label{subsec:single_accuracy}
次に，提案手法の予測精度の評価を行う．提案手法は2つのドッキングモード（SPモードおよびHTVSモード），
3つのフィルタリングスコア算出方法が存在するため合計6通りを示す．

\begin{table}[htb] \centering
	\caption{提案手法の予測精度}
	\label{table:single_accuracy}
	\begin{tabular}{l|l|rrrrr}
	\hline
	\multicolumn{1}{c|}{\mrow{2}{ドッキング計算}}	&\multicolumn{1}{c|}{化合物スコア}		&\multirow{2}{*}{ROC-AUC}	&\multicolumn{4}{c}{Enrichment Factor}	\\
											&\multicolumn{1}{c|}{算出方法}			&						&EF(1\%)	&EF(2\%)	&EF(5\%)	&EF(10\%)	\\ 
	\hline
											&総和(score\_sum)					&0.624					&5.08	&4.14	&3.02	&2.34		\\
	提案手法（SP）							&最良値(score\_max)					&0.637					&6.78	&\b{5.65}	&3.81	&2.60		\\
											&線形和(maxsumBS)					&\b{0.679}				&6.03	&5.03	&\b{3.96}	&\b{3.00}		\\
											&総和(score\_sum)					&0.618					&4.84	&3.97	&2.99	&2.29		\\
	提案手法（HTVS）							&最良値(score\_max)					&0.627					&\b{6.94}	&5.55	&3.32	&2.55		\\
											&線形和(maxsumBS)					&0.665					&5.98	&4.84	&3.58	&2.82		\\ 
	\hline
	\multicolumn{2}{c|}{簡易ドッキングシミュレーション}										&\mrow{2}{0.705}			&\mrow{2}{16.67}	&\mrow{2}{11.18}	&\mrow{2}{6.38}	&\mrow{2}{4.11}		\\ 
	\multicolumn{2}{c|}{（Glide HTVSモード）}											&&&&& \\
	\hline
	\end{tabular}
\end{table}

結果は表\ref{table:single_accuracy}の通りである．なお，各手法を用いた場合のターゲットごとのROC曲線は付録\ref{appendix:roc}に記載している．
この結果から，単体での予測精度に関しては，どの評価指標においてもGlide HTVSモードが高速性を重視した本研究の提案手法よりも
勝っていることが分かる．

また，提案手法間の比較を行うことで以下のことが言える．
\begin{itemize}
\item ドッキング計算について，化合物フィルタリングスコアの算出方法に関わらず，提案手法（SP）は提案手法（HTVS）と比べて
	ほぼすべての評価指標で予測精度が良くなる．
\item ROC-AUCはmaxsumBSが他の2つの提案手法に比べて良い結果が出ているが，EF (1\%)やEF (2\%)に関してはscore\_maxが
	maxsumBSを上回っている．
\end{itemize}
\ref{subsec:single_calc_time}で述べたように提案手法（SP）の速度は9倍程度，
従来手法に比べて高速であるので，以下の実験ではフラグメントのドッキングシミュレーションにGlide SPモードを用いることとする．

\newpage

\subsection{フィルタリング手法としての性能評価実験}
\ref{subsec:single_calc_time}節および\ref{subsec:single_accuracy}節では，フィルタリング手法を単体で用いた場合の性能を評価し，
速度では提案手法が勝っているものの，精度ではGlide HTVSモードに後塵を拝する結果となった．
しかし，本研究で提案した手法はフィルタリングを想定したものであり，その次に行われる
通常のドッキングシミュレーション手法と組み合わせた場合の速度や精度の評価はより重要となる．


この節では通常のドッキングシミュレーションであるGlide SPモードとの組み合わせを通した評価を行う．
組み合わせを通した評価は
\begin{enumerate}
\item フィルタリング手法で2\%, 5\%, 10\%まで化合物を削減（以下，この割合を「通過率」と示す）
\item 残った化合物を通常のドッキングシミュレーション（Glide SPモード）で再計算
\item 再計算の結果の上位1\%および上位2\%の濃縮率(EF (1\%), EF (2\%))を評価
\end{enumerate}
という手順を用いる．
なおフィルタリング手法を用いて2\%まで削減した場合，EF (2\%)はフィルタリング手法単体の性能と変わらなくなるため，
「\textendash」と表記する．

\begin{figure}[htp]
 \begin{center}
  \fig[width=0.99\hsize]{./fig/result/filtering_image.png}
  \caption{EF（1\%），EF（2\%）算出までの流れ}
  \label{fig:filtering_image}
 \end{center}
\end{figure}

\newpage

\subsubsection{提案手法間の精度比較}\label{subsubsec:filtering_proposal}
まず提案手法間の精度比較を行い，化合物フィルタリングスコアの算出方法を検討した．
結果は表\ref{table:filtering_proposal}のようになり，多くの場合
フィルタリングスコア算出方法はmaxsumBSを用いるのが最適であることが分かった．

\begin{table}[htb] \centering
	\caption{フィルタリング手法としての提案手法間の精度評価}
	\label{table:filtering_proposal}
	\begin{tabular}{lc|rr|r}
	\hline
	\multicolumn{2}{c|}{フィルタリング}	&\multirow{2}{*}{EF（1\%）}	&\multirow{2}{*}{EF（2\%）}	&合計計算時間	\\
	\multicolumn{1}{c}{手法}	&通過率	&						&						&[CPU sec.]		\\ \hline
	総和（score\_sum）		&		&6.84					&\textendash				&				\\
	最良値（score\_max）	&2\%	&\textbf{9.09}				&\textendash				&6,396			\\
	線形和（maxsumBS）	&		&8.75					&\textendash				&				\\ \hline
	総和（score\_sum）		&		&9.61					&5.92					&				\\
	最良値（score\_max）	&5\%	&10.93					&7.49					&13,481			\\
	線形和（maxsumBS）	&		&\textbf{12.92}			&\textbf{7.99}				&				\\ \hline
	総和（score\_sum）		&		&12.41					&7.67					&				\\
	最良値（score\_max）	&10\%	&11.85					&8.24					&25,289			\\
	線形和（maxsumBS）	&		&\textbf{15.45}			&\textbf{10.00}			&				\\ \hline
	\end{tabular}
\end{table}


\subsubsection{予測精度の従来手法との比較}\label{subsubsec:filtering_comparison}
続いて，提案手法と従来手法との比較を行う．\ref{subsubsec:filtering_proposal}節の実験より，
提案手法のフィルタリングスコア算出法はmaxsumBSが最も良いことが示されたので，
ここではmaxsumBSとGlide HTVSモードとの速度および精度の比較を行う．

\begin{table}[htb] \centering
	\caption{フィルタリング手法としての提案手法と従来手法の比較}
	\label{table:filtering_proposal_Glide}
	\begin{tabular}{lc|rr|rr}
	\hline
	\multicolumn{2}{c|}{フィルタリング}					&\multirow{2}{*}{EF（1\%）}	&\multirow{2}{*}{EF（2\%）}	&合計計算時間	&\multicolumn{1}{c}{提案手法の}	\\
	\multicolumn{1}{c}{手法}		&通過率				&						&						&[CPU sec.]		&\multicolumn{1}{c}{高速化率}	\\ \hline
	提案手法（maxsumBS）		&\multirow{2}{*}{2\%}	&8.75					&\textendash				&6,396			&\mrow{2}{\b{x3.05}}\\
	従来手法（Glide HTVSモード）	&					&17.85					&\textendash				&19,536		&\\ \hline
	提案手法（maxsumBS）		&\multirow{2}{*}{5\%}	&12.92					&7.99					&13,481			&\mrow{2}{\b{x1.97}}\\
	従来手法（Glide HTVSモード）	&					&18.97					&12.50					&26,621		&\\ \hline
	提案手法（maxsumBS）		&\multirow{2}{*}{10\%}	&15.46					&10.00					&25,289			&\mrow{2}{\b{x1.52}}\\
	従来手法（Glide HTVSモード）	&					&19.60					&12.92					&38,429		&\\ \hline
	\multicolumn{2}{l|}{通常ドッキング（Glide SPモード）}	&21.54					&14.68					&\multicolumn{1}{r}{236,156}&	\\ \hline
	\end{tabular}
\end{table}

表\ref{table:filtering_proposal_Glide}の結果より，以下のことが言える．
\begin{itemize}
\item \ref{subsec:single_accuracy}節で示した単体での性能評価と同様に，Glide HTVSモードが
	提案手法よりも精度が良くなっている．
\item 一方，計算速度について，フィルタリングで元の化合物群の2\%を通過させる場合，提案手法と通常ドッキング計算の
	合計必要時間が従来用いられていたGlide HTVSモードよりも少なくなっており，これまででは達成できなかった速度での
	化合物の選別が可能になっていることがこの結果からわかる．この利点はフィルタを通過させる化合物の割合を高めるほど薄れて行く．
	これは，通常のドッキングシミュレーションの計算時間が支配的となり，
	提案しているフィルタリング手法の計算時間の面での利点が失われてしまうためである．
\end{itemize}