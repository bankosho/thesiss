\chapter{考察}

\section{score\_sum手法におけるフラグメント数に対するペナルティ}
今回、提案手法では重原子（水素以外の原子）の個数が2つ以下であるフラグメントはフィルタリングスコア算出から除外した。
これは、フラグメントの結合スコアの和を用いるscore\_sum手法において、図\ref{fig:no_omit_score_graph}のように、
化合物に属するフラグメントが多ければ多いほど同じ原子数であってもフィルタリングスコアが向上してしまうという現象が得られたためである。
\begin{figure}[bt]
 \begin{center}
  \fig[width=0.7\hsize]{./fig/discussion/no_omit_score.eps}
  \caption{ターゲットfntaの全てのligand, decoyのうち重原子数32の化合物のフラグメントスコアの単純加算}
  \label{fig:no_omit_score_graph}
 \end{center}
\end{figure}
この現象は最適化問題の条件緩和と考えることで説明できる。すなわち、本来化合物には原子間の結合距離という拘束条件が存在している。
フラグメント分割によって切断された原子間の結合は距離を考えずにスコア付けして良いので、分割は原子間の結合という拘束条件を
一つずつ緩和することに対応する。このため、フラグメント分割がされればされるほどスコアが良くなってしまうのである。

この現象を改善するため、本研究では小さなフラグメントの無視、およびフラグメント数に対して線形なペナルティの付加を実験した。
\begin{description}
\item[小さなフラグメントの無視] 提案手法として用いている手法である。分割が多ければ多いほど小さなフラグメントが発生するため、
	小さなフラグメントの結合スコアを無視することで事実上のフラグメント数に対するペナルティとなっている。
\item[フラグメント数に対する線形ペナルティ]
	図\ref{fig:no_omit_score_graph}を見ると、フィルタリングスコアの平均とフラグメント数との関係は線形に近い。このことから、
	フラグメント数に対して線形なペナルティを課すことでフラグメント数に依存しないフィルタリングスコアとなることが想定される。
\end{description}
この2つのペナルティ手法を個別に利用した場合の予測精度は表\ref{table:omit}および表\ref{table:penalty}のようになり、
総合すると重原子数3以下のフラグメントの結合スコアを無視することが最も精度を高めている。
\todo{CAUTION! 重原子数3以下のフラグメントの結合スコアを無視することが最も精度を高めているので、本論でもそのように修正すべき！！}

\begin{table}[t] \centering
	\caption{小さなフラグメントを無視することによる精度の変化}
	\label{table:omit}
	\begin{tabular}{c|rrrrr}
	\hline
	\multirow{2}{*}{無視するフラグメントのサイズ}	&\multirow{2}{*}{ROC-AUC}	&\multicolumn{4}{c}{Enrichment Factor}				\\
										&						&EF(1\%)		&EF(2\%)		&EF(5\%)		&EF(10\%)	\\ \hline
	全てのフラグメントを利用					&0.545					&3.46		&2.76		&2.01		&1.63		\\
	重原子数1							&0.557					&2.38		&2.16		&1.85		&1.66		\\
	重原子数2以下						&0.624					&5.08		&4.14		&3.02		&2.34		\\
	重原子数3以下						&0.634					&5.75		&4.34		&3.03		&2.49		\\
	重原子数4以下						&0.620					&4.27		&3.43		&2.79		&2.32		\\
	重原子数5以下						&0.614					&4.43		&3.68		&2.75		&2.13		\\
	重原子数6以下						&0.537					&2.20		&1.86		&1.53		&1.43		\\ \hline
	\end{tabular}
\end{table}

\begin{table}[hp] \centering
	\caption{フラグメント数に対する線形ペナルティによる精度の変化}
	\label{table:penalty}
	\begin{tabular}{c|rrrrr}
	\hline
	フラグメント1つあたりの	&\multirow{2}{*}{ROC-AUC}	&\multicolumn{4}{c}{Enrichment Factor}				\\
	ペナルティ$c$			&						&EF(1\%)		&EF(2\%)		&EF(5\%)		&EF(10\%)	\\ \hline
	ペナルティなし			&0.545					&3.46		&2.76		&2.01		&1.63		\\
	$c=1$				&0.559					&3.81		&2.98		&2.18		&1.77		\\
	$c=2$				&0.586					&4.70		&3.65		&2.66		&2.08		\\
	$c=3$				&0.622					&5.03		&4.03		&2.86		&2.32		\\
	$c=4$				&0.588					&3.80		&3.19		&2.51		&2.14		\\
	$c=5$				&0.549					&3.57		&2.96		&2.20		&1.78		\\ \hline
	\end{tabular}
\end{table}


\section{提案手法の得手・不得手の調査}
\ref{subsec:single_accuracy}節の実験結果より、提案手法は従来手法に比べて平均的に見れば精度が低調に終わることが判明した。
しかし、一部のターゲットに関しては提案手法が従来手法である glide HTVSモードに優っており（表\ref{table:target_accuracy_good}）、
この理由がわかればどのようなケースにおいて提案手法によるフィルタリングを用いるべきかを明示的にすることができる。
同様に提案手法が従来手法より明らかに悪いケース（表\ref{table:target_accuracy_bad}）に関して
原因が判明すれば、今後の提案手法の改善につながる。

\begin{table}[htb] \centering
	\caption{提案手法が上手く行ったケース}
	\label{table:target_accuracy_good}
	提案手法（score\_sum、score\_max、maxsumBSのいずれか）が従来手法（glide HTVSモード）\\
	よりもROC-AUCで0.2以上上回ったケースについて、ROC-AUCの差の降順で示している。
	\begin{tabular}{lc|r|rr}
	\hline
	\multirow{2}{*}{提案手法の種類}	&\multirow{2}{*}{ターゲット名}	&\multirow{2}{*}{ROC-AUC差}	&\multicolumn{2}{c}{ROC-AUC}	\\
								&						&							&従来手法	&提案手法		\\ \hline
	線形和（maxsumBS）			&mcr					&0.319						&0.466		&{\bf 0.785}		\\
	線形和（maxsumBS）			&akt1					&0.285						&0.539		&{\bf 0.824}		\\
	最良値（score\_max）			&kith					&0.272						&0.615		&{\bf 0.887}		\\
	最良値（score\_max）			&akt1					&0.265						&0.539		&{\bf 0.804}		\\
	最良値（score\_max）			&mcr					&0.257						&0.466		&{\bf 0.723}		\\
	線形和（maxsumBS）			&gcr						&0.252						&0.528		&{\bf 0.780}		\\
	最良値（score\_max）			&gcr						&0.242						&0.528		&{\bf 0.770}		\\
	総和（score\_sum）				&ital						&0.212						&0.529		&{\bf 0.741}		\\
	総和（score\_sum）				&akt1					&0.209						&0.539		&{\bf 0.748}		\\ \hline
	\end{tabular}
\end{table}
\begin{table}[htb] \centering
	\caption{提案手法が上手く行かないケース}
	\label{table:target_accuracy_bad}
	提案手法（score\_sum、score\_max、maxsumBSのいずれか）が従来手法（glide HTVSモード）\\
	よりもROC-AUCで-0.45以上下回ったケースについて、ROC-AUCの差の昇順で示している。
	\begin{tabular}{lc|r|rr}
	\hline
	\multirow{2}{*}{提案手法の種類}	&\multirow{2}{*}{ターゲット名}	&\multirow{2}{*}{ROC-AUC差}	&\multicolumn{2}{c}{ROC-AUC}	\\
								&						&							&従来手法	&提案手法		\\ \hline
	最良値（score\_max）			&lkha4					&-0.572						&{\bf 0.880}	&0.308			\\
	最良値（score\_max）			&xiap					&-0.506						&{\bf 0.802}	&0.296			\\
	総和（score\_sum）				&def						&-0.495						&{\bf 0.733}	&0.238			\\
	総和（score\_sum）				&wee1					&-0.487						&{\bf 0.933}	&0.446			\\
	総和（score\_sum）				&hs90a					&-0.464						&{\bf 0.761}	&0.297			\\
	線形和（maxsumBS）			&hs90a					&-0.460						&{\bf 0.761}	&0.301			\\
	線形和（maxsumBS）			&xiap					&-0.460						&{\bf 0.802}	&0.342			\\ \hline
	\end{tabular}
\end{table}

\subsection{提案手法が得意なターゲット}
表\ref{table:target_accuracy_good}より、提案手法が従来手法であるglide HTVSモードに明らかに優っているケースは
akt1, gcr, ital, kith, mcr各ターゲットである。
これらのターゲットについて、化合物の持つフラグメント数の平均、小さなフラグメントを削減した後のフラグメント数の平均、
sitemapによって計算された各タンパク質の結合部位のサイズを表\ref{table:good_property}にまとめた。
\begin{table}[htb] \centering
	\caption{提案手法が得意なターゲットの性質}
	\label{table:good_property}
	\begin{tabular}{c|rrrrrrr}
	\hline
	\multirow{2}{*}{ターゲット}	&\multicolumn{3}{c}{\multirow{2}{*}{フラグメント数の平均}}	&\multicolumn{3}{c}{重原子数2以下の}		&\multirow{2}{*}{結合部位のサイズ [$Å^3$]}	\\
							&		&		&								&\multicolumn{3}{c}{フラグメント数の平均}	&										\\
							&全体	&正例	&負例							&全体	&正例		&負例			&										\\ \hline
	akt1						&7.98	&6.94	&8.00							&4.64	&3.08		&4.66			&637									\\
	gcr						&5.93	&5.33	&5.94							&2.68	&2.00		&2.69			&471									\\
	ital						&7.63	&7.72	&7.62							&3.58	&2.74		&3.59			&198									\\
	kith						&7.58	&6.70	&7.60							&3.94	&3.72		&3.95			&648									\\
	mcr						&5.90	&5.43	&5.91							&2.67	&2.06		&2.68			&179									\\ \hline
	全102ターゲット平均		&7.22	&7.43	&7.21							&3.83	&3.78		&3.83			&										\\ \hline
	\end{tabular}
\end{table}
結合部位のサイズや個々のフラグメント数の正例/負例間の比較による傾向は見受けられなかったが、
重原子数が2以下のフラグメント数が5つのターゲット全てにおいて正例よりも負例の方が上回っていることが分かる。
例えば、図\ref{fig:ZINC02599970}のような環構造と環構造の間の距離が遠い化合物に比べて、
図\ref{fig:ZINC03782818}のような環と環との間をつなぐ部分が短い化合物は重原子数が2以下となるフラグメント数は少なくなる。
ターゲットが前者の化合物を好むのか、後者の化合物を好むのかを前もって判定することができれば、
この手法を用いるべきか否かを判定することができると考えられる。

\begin{figure}[bt]
\begin{minipage}{0.5\hsize}
 \begin{center}
  \fig[width=0.9\hsize]{./fig/discussion/ZINC02599970.eps}
  \caption{小さなフラグメントが大量に発生する例}
  \label{fig:ZINC02599970}
 \end{center}
\end{minipage}
\begin{minipage}{0.5\hsize}
 \begin{center}
  \fig[width=0.7\hsize]{./fig/discussion/ZINC03782818.eps}
  \caption{小さなフラグメントがあまり発生しない例}
  \label{fig:ZINC03782818}
 \end{center}
\end{minipage}
\end{figure}


\subsection{提案手法が不得意なターゲット}
\todo{def, hs90a, lkha4, wee1, xiapの5種類について、ROC曲線を示し、フラグメント数などからの説明を試みる。
タンパク質のポケットが大きいと苦手とか、そういう可能性はあるのかな・・？}

\memo{wee1, xiapは非常に柔らかい化合物がpositiveである模様。典型的なligandを表示して、cutした場合の例も示す。それによって、現在の手法ではスコアがどうしても低くなってしまうことを述べる。}


\section{提案手法のユースケース}
\ref{subsubsec:filtering_comparison}節の結果より、提案手法は精度より速度を重視したいケースにおいて有用であることは先に述べた。
ここではDUD-Eのターゲットの内、総化合物数が10,000以上である49ターゲットを用いて、フィルタリングにおける化合物の通過率がより少ない場合や、
さらに小さな割合におけるEFの評価（表\ref{table:usecase_accuracy}）および提案手法や従来手法のドッキング
所要時間（表\ref{table:usecase_speed}）を用い、大規模化合物ライブラリを利用する場合のユースケースを示す。
なお、総化合物数が10,000以上である49ターゲットの平均化合物数は22,259, 平均フラグメント種類数は4,588である。

\begin{landscape}
\begin{table}[p] \centering
	\caption{総化合物数が1万以上存在するDUD-Eのターゲットに対する評価実験}
	\label{table:usecase_accuracy}
	\begin{tabular}{lc|rrrrr|r}
	\hline
	\multicolumn{2}{c|}{フィルタリング}					&\multirow{2}{*}{EF（0.1\%）}	&\multirow{2}{*}{EF（0.2\%）}	&\multirow{2}{*}{EF（0.5\%）}	&\multirow{2}{*}{EF（1\%）}	&\multirow{2}{*}{EF（2\%）}	&合計計算時間	\\
	\multicolumn{1}{c}{手法}	&通過率					&						&						&						&						&						&[CPU sec.]		\\ \hline
	提案手法（maxsumBS）		&\multirow{2}{*}{0.5\%}	&14.33					&9.39					&\textendash				&\textendash				&\textendash				&3,280			\\
	従来手法（glide HTVSモード）	&					&35.16					&29.97					&\textendash				&\textendash				&\textendash				&25,452			\\
	提案手法（maxsumBS）		&\multirow{2}{*}{1\%}	&20.26					&13.91					&7.14					&\textendash				&\textendash				&5,180			\\
	従来手法（glide HTVSモード）	&					&35.36					&31.17					&22.19					&\textendash				&\textendash				&27,352			\\
	提案手法（maxsumBS）		&\multirow{2}{*}{2\%}	&24.87					&19.14					&10.57					&6.32					&\textendash				&8,979			\\
	従来手法（glide HTVSモード）	&					&35.54					&31.69					&23.10					&15.50					&\textendash				&31,151			\\
	提案手法（maxsumBS）		&\multirow{2}{*}{5\%}	&29.24					&25.04					&16.80					&10.51					&6.29					&20,378			\\
	従来手法（glide HTVSモード）	&					&35.54					&31.40					&23.56					&16.28					&10.59					&42,550			\\
	提案手法（maxsumBS）		&\multirow{2}{*}{10\%}	&31.94					&27.48					&19.68					&13.58					&8.36					&39,377			\\
	従来手法（glide HTVSモード）	&					&35.70					&31.78					&23.80					&16.89					&11.07					&61,549			\\ \hline
	\multicolumn{2}{l|}{通常ドッキング（glide SPモード）}	&35.98					&32.82					&25.57					&18.96					&12.82					&379,965			\\ \hline
	\end{tabular}
\end{table}
\end{landscape}

\begin{table}[htbp] \centering
	\caption{ドッキングシミュレーションに要する計算時間}
	\label{table:usecase_speed}
	\begin{tabular}{l|rrr}
	\hline
	\multirow{2}{*}{ドッキングの種類}		&ドッキングが			&総計算時間	&1構造あたり計算時間	\\ 
									&必要な構造数		&[CPU sec.]			&[CPU sec.]			\\ \hline
	フラグメントドッキング glide SPモード		&4,588				&1,380				&0.30				\\
	通常ドッキング glide HTVSモード		&\multirow{2}{*}{22,259}	&23,552				&1.06				\\
	通常ドッキング glide SPモード			&					&379,965				&17.07				\\ \hline
	\end{tabular}
\end{table}


\begin{description}
\item[超高速な化合物全体の評価]
	表\ref{table:usecase_accuracy}によると、提案手法で0.5\%の化合物をフィルタリングし、それらを通常のドッキングシミュレーションで再評価
	することでglide HTVSモードを用いる場合の約8分の1の計算時間で評価を完了させることができる。例えば1,000万化合物を評価する場合、
	今回のケースの500倍程度の計算時間を要するとすればglide HTVSモードは1 CPU換算で4か月程度を要してしまう。
	一方、提案手法と通常ドッキングであるglide SPモードの組み合わせでは1 CPUでも半月程度で済む計算となる。この差は非常に大きく、
	提案手法は有用であると言える。
\end{description}
